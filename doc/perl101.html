<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contribution:perl</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body style="background-color: white">


<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#contribution_perl">Contribution:perl</a></li>
	<ul>

		<li><a href="#objects">Objects</a></li>
		<li><a href="#c101__model">C101::Model</a></li>
		<ul>

			<li><a href="#classes">Classes</a></li>
			<li><a href="#method_c101__model__renew_uuid">method C101::Model::renew_uuid</a></li>
			<li><a href="#method_c101__model__visit_c101__visitor__visitor___parent___index_">method C101::Model::visit(C101::Visitor $visitor, $parent?, $index?)</a></li>
		</ul>

		<li><a href="#c101__operations">C101::Operations</a></li>
		<ul>

			<li><a href="#cut_company_department_employee______">cut(Company|Department|Employee, ...)</a></li>
			<li><a href="#depth_company_department_employee______">depth(Company|Department|Employee, ...)</a></li>
			<li><a href="#median_company_department_employee______">median(Company|Department|Employee, ...)</a></li>
			<li><a href="#total_company_department_employee______">total(Company|Department|Employee, ...)</a></li>
			<li><a href="#uuids_company_department_employee______">uuids(Company|Department|Employee, ...)</a></li>
		</ul>

		<li><a href="#c101__persistence">C101::Persistence</a></li>
		<ul>

			<li><a href="#serialize__thing___filename___unserialize__filename_">serialize($thing, $filename)&gt;/unserialize($filename)</a></li>
			<li><a href="#parse__json____type____unparse_company_department_employee_">parse($json, [$type])&gt;/unparse(Company|Department|Employee)</a></li>
		</ul>

		<li><a href="#c101__sample">C101::Sample</a></li>
		<li><a href="#c101__visitor">C101::Visitor</a></li>
		<ul>

			<li><a href="#regular_visits">Regular Visits</a></li>
			<li><a href="#advanced_visits">Advanced Visits</a></li>
		</ul>

	</ul>

</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<h1><a name="contribution_perl">Contribution:perl</a></h1>
<p>This documentation describes each of the Perl Module (<code>.pm</code>) files.</p>
<p>
</p>
<h2><a name="objects">Objects</a></h2>
<p>This contribution uses <em>Moops</em> for its object
models. Accessors are automatically provided for all properties and they all work the
same, so they won't be documented explictly for every property.</p>
<p>The accessors are methods with the same name as the property. For example, to get the
<code>name</code> property from some object <code>obj</code>, you would write
<code>my $name = $obj-&gt;name</code>. To set a name, just pass the new name as the parameter:
<code>$obj-&gt;name($new_name)</code>.</p>
<p>Private properties and methods start with an underscore, but their privacy isn't enforced
by the language. Still, you shouldn't mess with them.</p>
<p>
</p>
<h2><a name="c101__model">C101::Model</a></h2>
<p>The object model for 101Companies. Contains classes for Companies, Departments and
Employees, which are all extensions of the Model class.</p>
<p>Each model object has a name and a UUID, the latter of which will be generated
automatically and can be renewed with <a href="#method_c101__model__renew_uuid">renew_uuid</a>.</p>
<p>There is also the two roles <em>Departments</em> and <em>Employees</em>, which give a model class
a list of Departments or Employees respectively.</p>
<p>
</p>
<h3><a name="classes">Classes</a></h3>
<dl>
<dt><strong><a name="company_extends_model_with_departments" class="item"><em>Company</em> extends Model with Departments</a></strong></dt>

<dt><strong><a name="department_extends_model_with_departments_employees" class="item"><em>Department</em> extends Model with Departments, Employees</a></strong></dt>

<dt><strong><a name="employee_extends_model" class="item"><em>Employee</em> extends Model</a></strong></dt>

</dl>
<p>
</p>
<h3><a name="method_c101__model__renew_uuid">method C101::Model::renew_uuid</a></h3>
<p>Gives the object a newly generated UUID. The old UUID is returned.</p>
<p>
</p>
<h3><a name="method_c101__model__visit_c101__visitor__visitor___parent___index_">method C101::Model::visit(C101::Visitor $visitor, $parent?, $index?)</a></h3>
<p>Hosts a visit for the given $visitor. This will call the visitor's appropriate <em>begin</em>
callback, then visit all its Employees and then Departments (if the object implements
those respective roles) and finally call the visitor's appropriate <em>end</em> callback.</p>
<p>When visiting Employees or Departments, the list that is being iterated through and a
reference to the iteration index will be passed as $parent and $index respectively. When
calling this method from somewhere else, make sure to pass such a list and index
reference if your visitor needs it.</p>
<p>See also <a href="#c101__visitor">C101::Visitor</a>.</p>
<p>
</p>
<h2><a name="c101__operations">C101::Operations</a></h2>
<p>Simple feature implementations, like total and cut. Each of the operations takes a list
of zero or more Companies, Departments and Employees (or a mix of them).</p>
<p>
</p>
<h3><a name="cut_company_department_employee______">cut(Company|Department|Employee, ...)</a></h3>
<p>Implements Feature:Cut. Halves all employees' salaries, salaries of 0 are left alone.
Nothing is returned.</p>
<p>
</p>
<h3><a name="depth_company_department_employee______">depth(Company|Department|Employee, ...)</a></h3>
<p>Implements Feature:Depth. Returns the maximum depth of the given objects.</p>
<p>
</p>
<h3><a name="median_company_department_employee______">median(Company|Department|Employee, ...)</a></h3>
<p>Implements Feature:Median. Returns the median salary of all given employees. If there are
no employees, 0 will be returned.</p>
<p>
</p>
<h3><a name="total_company_department_employee______">total(Company|Department|Employee, ...)</a></h3>
<p>Implements Feature:Total. Returns the sum of all given employees' salaries.</p>
<p>
</p>
<h3><a name="uuids_company_department_employee______">uuids(Company|Department|Employee, ...)</a></h3>
<p>Returns a reference to a hash mapping from UUIDs to their respective Company, Department
or Employee. Dies if one of the UUIDs is not actually unique.</p>
<p>
</p>
<h2><a name="c101__persistence">C101::Persistence</a></h2>
<p>Contains serialization and parsing features.</p>
<p>
</p>
<h3><a name="serialize__thing___filename___unserialize__filename_">serialize($thing, $filename)&gt;/unserialize($filename)</a></h3>
<p>Implements Feature:Serialization. Serializes the given thing to the given file and
unserializes a thing from the given file. The thing must be some kind of scalar.</p>
<p>
</p>
<h3><a name="parse__json____type____unparse_company_department_employee_">parse($json, [$type])&gt;/unparse(Company|Department|Employee)</a></h3>
<p>Implements Feature:Parsing and Feature:Unparsing.
Parses the given JSON string into a Company, Department or Employee object and unparses
such an object into a JSON string. For parsing, the type of the parsed object can be
given (<code>'company'</code>, <code>'department'</code> or <code>'employee'</code>), otherwise it will be guessed.</p>
<p>
</p>
<h2><a name="c101__sample">C101::Sample</a></h2>
<p>Calling <code>sample()</code> will return a newly created sample Company. It's always the same
company, only the UUIDs will differ.</p>
<p>
</p>
<h2><a name="c101__visitor">C101::Visitor</a></h2>
<p>Visitor class for traversing the object tree of Companies, Departments and Employees.</p>
<p>The class provides the following six callbacks that are called when the traversal enters
or exits the given type ($self being the visitor itself):</p>
<dl>
<dt><strong><a name="begin_company" class="item"><code>begin_company($self, $company, $parent?, $index?)</code></a></strong></dt>

<dt><strong><a name="begin_department" class="item"><code>begin_department($self, $department, $parent?, $index?)</code></a></strong></dt>

<dt><strong><a name="begin_employee" class="item"><code>begin_employee($self, $employee, $parent?, $index?)</code></a></strong></dt>

<dt><strong><a name="end_employee" class="item"><code>end_employee($self, $employee, $parent?, $index?)</code></a></strong></dt>

<dt><strong><a name="end_department" class="item"><code>end_department($self, $department, $parent?, $index?)</code></a></strong></dt>

<dt><strong><a name="end_company" class="item"><code>end_company($self, $company, $parent?, $index?)</code></a></strong></dt>

</dl>
<p>
</p>
<h3><a name="regular_visits">Regular Visits</a></h3>
<p>To actually visit something, fill the callbacks you need with appropriate subs and call a
Company's, Department's or Employee's <code>visit</code> function. For example, a visitor to print
the structure of an object tree <code>$obj</code>:</p>
<pre>
    my $depth   = 0;
    my $visitor = C101::Visitor-&gt;new({
        begin_company =&gt; sub {
            my ($self, $company) = @_;
            print &quot;\t&quot; x $depth++, &quot;Company: ${\$company-&gt;name}\n&quot;;
        },
        begin_department =&gt; sub {
            my ($self, $department) = @_;
            print &quot;\t&quot; x $depth++, &quot;Department: ${\$department-&gt;name}\n&quot;;
        },
        begin_employee =&gt; sub {
            my ($self, $employee) = @_;
            print &quot;\t&quot; x $depth++, &quot;Employee: ${\$employee-&gt;name}\n&quot;;
        },
        end_employee =&gt; sub {
            my ($self, $employee) = @_;
            print &quot;\t&quot; x $depth,   &quot;Address: ${\$employee-&gt;salary}\n&quot;;
            print &quot;\t&quot; x $depth--,  &quot;Salary: ${\$employee-&gt;salary}\n&quot;;
        },
        end_department =&gt; sub {
            --$depth;
        },
        end_company =&gt; sub {
            --$depth;
        },
    });
    $obj-&gt;visit($visitor);</pre>
<p>
</p>
<h3><a name="advanced_visits">Advanced Visits</a></h3>
<p>More complicated structural operations like additions or deletions are still possible
with visitors, but they require a bit more reflection. So in the callbacks, $parent is a
reference to the list that is currently being iterated through and of which the current
element is a part of and $index is a reference to the iteration index. At top level, you
may not be iterating through a list at all (e.g. because you're only visiting a single
company), which is why those parameters are optional.</p>
<p>You need to make sure that when modifying the parent list, you probably also need to
modify the iteration $index. For example, when you want to fire every employee with a
salary over 9999.99 as part of a 99% ralley, you need to decrement the index every time
that happens. Otherwise the index would be incremented normally on the next iteration and
you'd potentially skip over a part of the 1%.</p>
<pre>
    my $visitor = C101::Visitor-&gt;new({
        begin_employee =&gt; sub {
            my ($self, $employee, $parent, $index) = @_;
            delete $parent-&gt;[$$index--] if $employee-&gt;salary &gt; 9999.99;
        },
    });
    $obj-&gt;visit($visitor);</pre>

</body>

</html>
